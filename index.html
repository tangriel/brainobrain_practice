<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <title>Mental Math Trainer</title>
    <style>
        /* Basic styling for better readability */
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: #ffffff;
        }
        h1, h2 {
            color: #2c3e50;
        }
        .section {
            background-color: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Controls */
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            align-items: start;
        }
        .controls > div { display: flex; flex-direction: column; }
        .generate-btn-container { grid-column: 1 / -1; margin-top: 15px; }
        label { display:block; margin-bottom:8px; font-weight:700; font-size:0.95rem; }

        /* Make drop-downs (selects) wider so full values fit.
           They remain responsive: on small screens min-width resets. */
        .controls select {
            min-width: 260px;
            max-width: 100%;
            width: auto;
        }

        select, input, button {
            padding: 10px 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
            box-sizing: border-box;
            font-size: 1rem;
        }

        .input-with-label { display:flex; align-items:center; }
        .input-with-label input { margin-right:8px; flex-grow:1; }
        .input-with-label span { white-space:nowrap; font-size:0.9em; }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.25s;
            width: 100%;
            font-weight: bold;
        }
        button:hover { background-color: #2980b9; }

        .exercises {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        .exercise {
            background-color: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        .answer { color: #e74c3c; font-weight:700; display:none; }
        .show-answer-btn { background:#27ae60; color:#fff; margin-top:10px; }
        .show-all-btn { background:#f39c12; color:#fff; margin-top:12px; }
        .eye-icon { margin-left:6px; vertical-align:middle; }

        /* Abacus (Soroban) styling */
        .abacus-section .abacus-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            align-items: center;
            margin-bottom: 12px;
        }

        .abacus {
            position: relative;
            width: 100%;
            max-width: 780px;
            margin: 10px auto 0;
            padding: 18px;
            background: linear-gradient(180deg,#e9d59a,#e4c77a);
            border-radius: 12px;
            box-shadow: inset 0 6px 12px rgba(0,0,0,0.06), 0 2px 6px rgba(0,0,0,0.12);
            overflow: hidden; /* IMPORTANT: hide beads overflow so cover fully conceals them */
        }

        /* Rail contains the rods; keeps layout for columns */
        .abacus-rail {
            display: flex;
            justify-content: center;
            gap: 12px;
            padding: 18px 8px;
            position: relative;
            border-radius: 8px;
            background: linear-gradient(180deg, rgba(0,0,0,0.02), transparent);
        }

        .abacus-column {
            width: 56px;
            min-width: 44px;
            height: 220px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .abacus-bead {
            width: 40px;
            height: 40px;
            border-radius:50%;
            background:#6b3f2b;
            box-shadow: 0 3px 0 rgba(0,0,0,0.25);
            transition: transform .22s ease;
            flex-shrink: 0;
        }

        /* Heaven bead (5) */
        .top-bead {
            width: 36px; height:36px;
            background:#8b4f34;
            box-shadow: 0 2px 0 rgba(0,0,0,0.2);
        }

        .bottom-bead {
            width:36px; height:36px; background:#6b3f2b;
        }

        .top-space {
            height: 58px; display:flex; align-items:center; justify-content:center;
        }

        .bottom-beads {
            display:flex; flex-direction:column; gap:12px; margin-top:8px; align-items:center;
        }

        .abacus-beam {
            height:8px;
            width:100%;
            margin:6px 0;
            background:#2f2f2f;
            border-radius:4px;
            position:relative;
            box-shadow: 0 1px 0 rgba(255,255,255,0.08) inset;
        }

        .abacus-group-dot {
            position:absolute;
            top:50%;
            left:50%;
            transform:translate(-50%,-50%);
            width:8px; height:8px;
            border-radius:50%;
            background:#fff;
            box-shadow: 0 0 0 1px rgba(255,255,255,0.08) inset;
            opacity:0.95;
        }

        /*
         Soroban movement:
         - top bead inactive: moved up (away from beam), active: moved down (to beam)
         - bottom beads inactive: moved down (away), active: moved up (to beam)
        */
        .top-bead { transform: translateY(-36px); }    /* up when inactive */
        .top-bead.active { transform: translateY(0); }  /* down to beam when active */

        .bottom-bead { transform: translateY(36px); }    /* down when inactive */
        .bottom-bead.active { transform: translateY(0); } /* up to beam when active */

        /* COVER: now covers the entire .abacus area and is almost opaque */
        .abacus-cover {
            position: absolute;
            inset: 0;
            background: rgba(255,255,255,0.995); /* nearly solid white to fully hide beads */
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1.05em;
            color: #333;
            border-radius: 12px;
            z-index: 40;
            padding: 10px;
            text-align: center;
            pointer-events: auto;
        }
        .abacus-cover.show { display:flex; }

        /* Buttons & answer moved OUTSIDE the abacus field so cover won't overlap them */
        .abacus-controls-row {
            margin-top: 12px;
            display:flex;
            gap:12px;
            align-items:center;
            justify-content:space-between;
            flex-wrap:wrap;
        }
        .abacus-controls-row .left { display:flex; gap:8px; align-items:center; }
        .abacus-controls-row button { width:auto !important; min-width:110px; padding:8px 12px; font-weight:700; }

        .peek-btn { background:#8e44ad; color:#fff; border:0; border-radius:4px; }
        .peek-btn:hover { background:#712e93; }
        .peek-btn:disabled { opacity:0.6; cursor:not-allowed; }

        .abacus-number-display { font-size:1.25rem; font-weight:800; color:#c0392b; min-width:110px; text-align:right; }

        /* Responsive adjustments */
        @media (max-width: 760px) {
            .controls select { min-width: 180px; }
            .abacus-column { width:46px; height:190px; }
            .abacus-bead, .top-bead, .bottom-bead { width:32px; height:32px; }
            .top-space { height:48px; }
            .abacus-number-display { text-align:center; min-width:0; }
        }
        @media (max-width: 420px) {
            .controls select { min-width: 0; }
            .controls { grid-template-columns: 1fr 1fr; gap:10px; }
            .abacus-rail { gap:8px; padding:12px 6px; }
        }
    </style>
</head>
<body>
    <h1>Mental Math Trainer</h1>

    <!-- Addition Section -->
    <div class="section" id="addition-section">
        <h2>Addition Exercises</h2>
        <div class="controls">
            <div>
                <label for="add-count">Number of Exercises:</label>
                <input type="number" id="add-count" min="1" max="20" value="3">
            </div>
            <div>
                <label for="add-type">Number Type:</label>
                <select id="add-type">
                    <option value="sd">Single-Digit Only</option>
                    <option value="dd">Double-Digit Only</option>
                    <option value="mixed" selected>Single & Double-Digit Mix</option>
                </select>
            </div>
            <div>
                <label for="add-addends">Number of Addends:</label>
                <div class="input-with-label">
                    <input type="number" id="add-addends" min="3" max="20" value="4">
                    <span>numbers</span>
                </div>
            </div>
            <div class="generate-btn-container">
                <button id="generate-add-btn">Generate Addition Exercises</button>
            </div>
        </div>
        <div id="add-exercises" class="exercises"></div>
        <button id="show-all-add" class="show-all-btn">Show All Answers <span class="eye-icon">üëÅÔ∏è</span></button>
    </div>

    <!-- Multiplication Section -->
    <div class="section" id="multiplication-section">
        <h2>Multiplication Exercises</h2>
        <div class="controls">
            <div>
                <label for="mult-count">Number of Exercises:</label>
                <input type="number" id="mult-count" min="1" max="20" value="3">
            </div>
            <div>
                <label for="mult-type">Number Type:</label>
                <select id="mult-type">
                    <option value="sd_sd">Single-Digit √ó Single-Digit</option>
                    <option value="dd_sd" selected>Double-Digit √ó Single-Digit</option>
                    <option value="td_sd">Triple-Digit √ó Single-Digit</option>
                    <option value="dd_dd">Double-Digit √ó Double-Digit</option>
                </select>
            </div>
            <div></div>
            <div class="generate-btn-container">
                <button id="generate-mult-btn">Generate Multiplication Exercises</button>
            </div>
        </div>
        <div id="mult-exercises" class="exercises"></div>
        <button id="show-all-mult" class="show-all-btn">Show All Answers <span class="eye-icon">üëÅÔ∏è</span></button>
    </div>

    <!-- Division Section -->
    <div class="section" id="division-section">
        <h2>Division Exercises</h2>
        <div class="controls">
            <div>
                <label for="div-count">Number of Exercises:</label>
                <input type="number" id="div-count" min="1" max="20" value="3">
            </div>
            <div>
                <label for="div-type">Number Type:</label>
                <select id="div-type">
                    <option value="dd_sd" selected>Double-Digit √∑ Single-Digit</option>
                    <option value="td_sd">Triple-Digit √∑ Single-Digit</option>
                    <option value="fd_sd">Four-Digit √∑ Single-Digit</option>
                    <option value="fd_dd">Four-Digit √∑ Double-Digit</option>
                </select>
            </div>
            <div></div>
            <div class="generate-btn-container">
                <button id="generate-div-btn">Generate Division Exercises</button>
            </div>
        </div>
        <div id="div-exercises" class="exercises"></div>
        <button id="show-all-div" class="show-all-btn">Show All Answers <span class="eye-icon">üëÅÔ∏è</span></button>
    </div>

    <!-- Flashcards (Soroban) Section -->
    <div class="section abacus-section" id="abacus-section">
        <h2>Flashcards ‚Äî Soroban (Japanese abacus)</h2>

        <div class="abacus-controls">
            <div>
                <label for="abacus-digits">Digits (1‚Äì6):</label>
                <input type="number" id="abacus-digits" min="1" max="6" value="3">
            </div>
            <div>
                <label for="abacus-duration">Show for (seconds):</label>
                <input type="number" id="abacus-duration" min="1" max="10" value="3">
            </div>
            <div>
                <label>&nbsp;</label>
                <div class="generate-btn-container">
                    <button id="generate-abacus-btn">Generate Abacus Flashcard</button>
                </div>
            </div>
        </div>

        <!-- Abacus field (cover now inside .abacus and covers whole field) -->
        <div class="abacus" id="abacus-display" aria-live="polite">
            <div class="abacus-rail" id="abacus-rail">
                <!-- columns generated dynamically -->
            </div>

            <!-- cover placed inside .abacus so it covers the entire abacus field -->
            <div class="abacus-cover" id="abacus-cover">Memorize the beads... (hidden)</div>
        </div>

        <!-- Controls moved OUTSIDE the abacus field (so cover won't hide them) -->
        <div class="abacus-controls-row">
            <div class="left">
                <button id="show-abacus-answer" class="show-answer-btn">Show Answer <span class="eye-icon">üëÅÔ∏è</span></button>
                <button id="peek-abacus-btn" class="peek-btn">Peek Again</button>
            </div>
            <div class="abacus-number-display" id="abacus-number-display" aria-hidden="true"></div>
        </div>
    </div>

    <footer>
        Created for mental arithmetic practice - BrainOBrain Exercises
    </footer>

    <script>
        // ===== Utility functions =====
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        function getRandomSingleDigit() { return getRandomInt(2, 9); }
        function getRandomDoubleDigit() { return getRandomInt(11, 99); }
        function getRandomTripleDigit() { return getRandomInt(100, 999); }
        function getRandomFourDigit() { return getRandomInt(1000, 9999); }
        function shuffleArray(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }

        // ===== Arithmetic functions (kept original logic) =====
        function generateAdditionExercise(type, numAddends) {
            let addends = [];
            let runningSum = 0;
            const maxNegatives = Math.floor(numAddends / 3);
            let numNegatives = 0;

            if (type === "sd") {
                for (let i = 0; i < numAddends; i++) addends.push(getRandomSingleDigit());
            } else if (type === "dd") {
                for (let i = 0; i < numAddends; i++) addends.push(getRandomDoubleDigit());
            } else {
                const doubleDigitCount = Math.max(0, Math.min(
                    numAddends,
                    getRandomInt(Math.max(0,Math.floor(numAddends/2)-1), Math.floor(numAddends/2)+1)
                ));
                let types = [];
                for (let i = 0; i < numAddends; i++) types.push(i < doubleDigitCount ? "dd" : "sd");
                types = shuffleArray(types);
                for (let i = 0; i < numAddends; i++) addends.push(types[i] === "dd" ? getRandomDoubleDigit() : getRandomSingleDigit());
            }

            addends.sort((a,b)=>Math.abs(b)-Math.abs(a));
            const finalAddends = [];
            for (const num of addends) {
                let finalNum = num;
                if (numNegatives < maxNegatives && Math.random() < 0.3) {
                    if (runningSum > num) { finalNum = -num; numNegatives++; }
                }
                finalAddends.push(finalNum);
                runningSum += finalNum;
            }

            let best = [...finalAddends];
            let attempts = 0;
            while (attempts < 10) {
                attempts++;
                const test = [...finalAddends];
                shuffleArray(test);
                let sum = 0, ok = true;
                for (const n of test) { sum += n; if (sum < 0) { ok = false; break; } }
                if (ok) { best = test; break; }
            }

            return { addends: best, answer: best.reduce((s,n)=>s+n,0) };
        }

        function generateMultiplicationExercise(type) {
            let a,b;
            switch(type){
                case "sd_sd": a=getRandomSingleDigit(); b=getRandomSingleDigit(); break;
                case "dd_sd": a=getRandomDoubleDigit(); b=getRandomSingleDigit(); break;
                case "td_sd": a=getRandomTripleDigit(); b=getRandomSingleDigit(); break;
                case "dd_dd": a=getRandomDoubleDigit(); do{ b=getRandomDoubleDigit(); } while(b===10); break;
                default: a=getRandomSingleDigit(); b=getRandomSingleDigit();
            }
            return { factors:[a,b], answer: a*b };
        }

        function generateDivisionExercise(type) {
            let dividend, divisor;
            switch(type){
                case "dd_sd":
                    divisor = getRandomSingleDigit();
                    { const min=Math.ceil(10/divisor), max=Math.floor(99/divisor); dividend = divisor * getRandomInt(min, max); }
                    break;
                case "td_sd":
                    divisor = getRandomSingleDigit();
                    { const min=Math.ceil(100/divisor), max=Math.floor(999/divisor); dividend = divisor * getRandomInt(min, max); }
                    break;
                case "fd_sd":
                    divisor = getRandomSingleDigit();
                    { const min=Math.ceil(1000/divisor), max=Math.floor(9999/divisor); dividend = divisor * getRandomInt(min, max); }
                    break;
                case "fd_dd":
                    do { divisor = getRandomInt(11,50); } while(divisor === 10);
                    { const min=Math.ceil(1000/divisor), max=Math.floor(9999/divisor); dividend = divisor * getRandomInt(min, max); }
                    break;
                default:
                    divisor = getRandomSingleDigit();
                    dividend = divisor * getRandomInt(10,99);
            }
            return { dividend, divisor, answer: dividend / divisor };
        }

        function createAdditionExerciseElement(exercise, index) {
            const div = document.createElement('div'); div.className = 'exercise';
            let html = `<strong>${index}.</strong> `;
            for (let i=0;i<exercise.addends.length;i++){
                const n = exercise.addends[i];
                if (i===0) html += n;
                else html += n < 0 ? ` - ${Math.abs(n)}` : ` + ${n}`;
            }
            html += ` = <span class="answer">${exercise.answer}</span>`;
            div.innerHTML = html;
            const btn = document.createElement('button'); btn.className='show-answer-btn'; btn.innerHTML='Show Answer <span class="eye-icon">üëÅÔ∏è</span>';
            btn.onclick = ()=>{ div.querySelector('.answer').style.display='inline'; btn.style.display='none'; };
            div.appendChild(btn);
            return div;
        }

        function createMultiplicationExerciseElement(exercise, index){
            const div = document.createElement('div'); div.className='exercise';
            div.innerHTML = `<strong>${index}.</strong> ${exercise.factors[0]} √ó ${exercise.factors[1]} = <span class="answer">${exercise.answer}</span>`;
            const btn = document.createElement('button'); btn.className='show-answer-btn'; btn.innerHTML='Show Answer <span class="eye-icon">üëÅÔ∏è</span>';
            btn.onclick = ()=>{ div.querySelector('.answer').style.display='inline'; btn.style.display='none'; };
            div.appendChild(btn); return div;
        }

        function createDivisionExerciseElement(exercise, index){
            const div = document.createElement('div'); div.className='exercise';
            div.innerHTML = `<strong>${index}.</strong> ${exercise.dividend} √∑ ${exercise.divisor} = <span class="answer">${exercise.answer}</span>`;
            const btn = document.createElement('button'); btn.className='show-answer-btn'; btn.innerHTML='Show Answer <span class="eye-icon">üëÅÔ∏è</span>';
            btn.onclick = ()=>{ div.querySelector('.answer').style.display='inline'; btn.style.display='none'; };
            div.appendChild(btn); return div;
        }

        // ===== Soroban (abacus) functions =====

        // Build columns for soroban: top bead, beam (with grouping dot), bottom 4 beads
        function buildAbacusColumns(n) {
            const rail = document.getElementById('abacus-rail');
            if (!rail) return;
            rail.innerHTML = ''; // clear only the rail (cover is separate inside .abacus)
            for (let i = 0; i < n; i++) {
                const col = document.createElement('div');
                col.className = 'abacus-column';
                col.dataset.index = i;

                // TOP (heaven bead)
                const topSpace = document.createElement('div');
                topSpace.className = 'top-space';
                const topBead = document.createElement('div');
                topBead.className = 'abacus-bead top-bead';
                topBead.setAttribute('aria-hidden', 'true');
                topSpace.appendChild(topBead);

                // BEAM
                const beam = document.createElement('div');
                beam.className = 'abacus-beam';
                const indexFromRight = (n - 1 - i);
                if (indexFromRight % 3 === 0) {
                    const dot = document.createElement('div'); dot.className = 'abacus-group-dot'; beam.appendChild(dot);
                }

                // BOTTOM (four earth beads)
                const bottom = document.createElement('div');
                bottom.className = 'bottom-beads';
                for (let j = 0; j < 4; j++) {
                    const b = document.createElement('div');
                    b.className = 'abacus-bead bottom-bead';
                    b.setAttribute('aria-hidden', 'true');
                    bottom.appendChild(b);
                }

                // order: top -> beam -> bottom
                col.appendChild(topSpace);
                col.appendChild(beam);
                col.appendChild(bottom);
                rail.appendChild(col);
            }
        }

        function setAbacusColumn(columnElement, digit) {
            const topBead = columnElement.querySelector('.top-bead');
            const bottomBeads = Array.from(columnElement.querySelectorAll('.bottom-bead'));

            if (!topBead) return;
            // top/bead: active if digit >= 5
            if (digit >= 5) topBead.classList.add('active'); else topBead.classList.remove('active');

            // bottom beads: activate closest-to-beam beads first -> in DOM order top-to-bottom
            const bottomActive = digit % 5;
            bottomBeads.forEach((b, idx) => {
                if (idx < bottomActive) b.classList.add('active'); else b.classList.remove('active');
            });
        }

        function renderAbacusForNumber(numStr) {
            const rail = document.getElementById('abacus-rail');
            const cols = Array.from(rail.querySelectorAll('.abacus-column'));
            const padded = String(numStr).padStart(cols.length, '0');
            for (let i = 0; i < cols.length; i++) {
                const digit = parseInt(padded[i], 10);
                setAbacusColumn(cols[i], isNaN(digit) ? 0 : digit);
            }
        }

        function generateRandomNumberWithDigits(digits) {
            if (digits <= 1) return String(getRandomInt(0, 9));
            const min = Math.pow(10, digits - 1), max = Math.pow(10, digits) - 1;
            return String(getRandomInt(min, max));
        }

        // cover & timers
        let abacusCoverTimer = null;
        function clearAbacusCoverTimer(){ if (abacusCoverTimer){ clearTimeout(abacusCoverTimer); abacusCoverTimer = null; } }
        function showAbacusCover(){ const c = document.getElementById('abacus-cover'); if (c) c.classList.add('show'); }
        function hideAbacusCover(){ const c = document.getElementById('abacus-cover'); if (c) c.classList.remove('show'); }

        // Generate abacus flashcard
        document.getElementById('generate-abacus-btn').addEventListener('click', function(){
            const digits = Math.max(1, Math.min(6, parseInt(document.getElementById('abacus-digits').value || 3, 10)));
            const duration = Math.max(1, Math.min(10, parseInt(document.getElementById('abacus-duration').value || 3, 10)));
            buildAbacusColumns(digits);
            const numberStr = generateRandomNumberWithDigits(digits);
            renderAbacusForNumber(numberStr);

            const numberDisplay = document.getElementById('abacus-number-display');
            numberDisplay.textContent = numberStr;
            numberDisplay.style.visibility = 'hidden';
            numberDisplay.setAttribute('aria-hidden','true');

            const showBtn = document.getElementById('show-abacus-answer');
            showBtn.style.display = 'inline-block';
            document.getElementById('peek-abacus-btn').disabled = false;

            // show beads initially
            hideAbacusCover();
            clearAbacusCoverTimer();
            abacusCoverTimer = setTimeout(()=>{ showAbacusCover(); abacusCoverTimer = null; }, duration * 1000);
        });

        // Show numeric answer (button is outside abacus field)
        document.getElementById('show-abacus-answer').addEventListener('click', function(){
            const numberDisplay = document.getElementById('abacus-number-display');
            numberDisplay.style.visibility = 'visible';
            numberDisplay.setAttribute('aria-hidden','false');
            // make sure beads visible too
            clearAbacusCoverTimer();
            hideAbacusCover();
            this.style.display = 'none';
        });

        // Peek Again: temporarily show beads (does not reveal numeric answer)
        document.getElementById('peek-abacus-btn').addEventListener('click', function(){
            const btn = this;
            const raw = parseInt(document.getElementById('abacus-duration').value || 3, 10);
            const seconds = Math.max(1, Math.min(10, raw));
            clearAbacusCoverTimer();
            hideAbacusCover();
            btn.disabled = true;
            abacusCoverTimer = setTimeout(()=>{ showAbacusCover(); abacusCoverTimer = null; btn.disabled = false; }, seconds * 1000);
        });

        // Arithmetic listeners
        document.getElementById('generate-add-btn').addEventListener('click', function(){
            const count = parseInt(document.getElementById('add-count').value || 3, 10);
            const type = document.getElementById('add-type').value;
            const addends = parseInt(document.getElementById('add-addends').value || 4, 10);
            const container = document.getElementById('add-exercises'); container.innerHTML='';
            for (let i=1;i<=count;i++){ container.appendChild(createAdditionExerciseElement(generateAdditionExercise(type, addends), i)); }
        });

        document.getElementById('generate-mult-btn').addEventListener('click', function(){
            const count = parseInt(document.getElementById('mult-count').value || 3, 10);
            const type = document.getElementById('mult-type').value;
            const container = document.getElementById('mult-exercises'); container.innerHTML='';
            for (let i=1;i<=count;i++){ container.appendChild(createMultiplicationExerciseElement(generateMultiplicationExercise(type), i)); }
        });

        document.getElementById('generate-div-btn').addEventListener('click', function(){
            const count = parseInt(document.getElementById('div-count').value || 3, 10);
            const type = document.getElementById('div-type').value;
            const container = document.getElementById('div-exercises'); container.innerHTML='';
            for (let i=1;i<=count;i++){ container.appendChild(createDivisionExerciseElement(generateDivisionExercise(type), i)); }
        });

        document.getElementById('show-all-add').addEventListener('click', ()=> showAllAnswers('add-exercises'));
        document.getElementById('show-all-mult').addEventListener('click', ()=> showAllAnswers('mult-exercises'));
        document.getElementById('show-all-div').addEventListener('click', ()=> showAllAnswers('div-exercises'));

        function showAllAnswers(containerId){
            const c = document.getElementById(containerId);
            if (!c) return;
            c.querySelectorAll('.answer').forEach(a=>a.style.display='inline');
            c.querySelectorAll('.show-answer-btn').forEach(b=>b.style.display='none');
        }

        // Initialize
        document.getElementById('generate-add-btn').click();
        document.getElementById('generate-mult-btn').click();
        document.getElementById('generate-div-btn').click();

        (function initAbacus(){
            const defaultDigits = Math.max(1, Math.min(6, parseInt(document.getElementById('abacus-digits').value || 3,10)));
            buildAbacusColumns(defaultDigits);
            const numberDisplay = document.getElementById('abacus-number-display');
            numberDisplay.textContent = ''.padStart(defaultDigits, '0');
            numberDisplay.style.visibility = 'hidden';
            // start with cover hidden (user sees beads initially)
            hideAbacusCover();
        })();
    </script>
</body>
</html>
